#!/usr/bin/env bash
set -Eeo pipefail

FRONTEND_BIND_IP=${FRONTEND_BIND_IP:=127.0.0.1}
FRONTEND_PUBLIC_ADDRESS=${FRONTEND_PUBLIC_ADDRESS:=127.0.0.1}
USE_JSON_DB_MANAGER=${USE_JSON_DB_MANAGER:=false}
MAX_BACKUP_NUMBER=${MAX_BACKUP_NUMBER:=5}
BACKUP_INTERVAL_MINUTES=${BACKUP_INTERVAL_MINUTES:=15}
LOAD_ALL_PROTOTYPES=${LOAD_ALL_PROTOTYPES:=false}
USE_EQUIPMENT_SLOT_TABLE_CACHE=${USE_EQUIPMENT_SLOT_TABLE_CACHE:=false}

cp /usr/share/mhserveremu/Config.ini.tmpl /usr/share/mhserveremu/Config.ini
sed -i 's/%%FRONTEND_BIND_IP%%/'"$FRONTEND_BIND_IP"'/g; s/%%FRONTEND_PUBLIC_ADDRESS%%/'"$FRONTEND_PUBLIC_ADDRESS"'/g; s/%%USE_JSON_DB_MANAGER%%/'"$USE_JSON_DB_MANAGER"'/g; s/%%MAX_BACKUP_NUMBER%%/'"$MAX_BACKUP_NUMBER"'/g; s/%%BACKUP_INTERVAL_MINUTES%%/'"$BACKUP_INTERVAL_MINUTES"'/g; s/%%LOAD_ALL_PROTOTYPES%%/'"$LOAD_ALL_PROTOTYPES"'/g; s/%%USE_EQUIPMENT_SLOT_TABLE_CACHE%%/'"$USE_EQUIPMENT_SLOT_TABLE_CACHE"'/g;' "/usr/share/mhserveremu/Config.ini"

exec "$@"